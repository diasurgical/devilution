; Listing generated by Microsoft (R) Optimizing Compiler Version 12.00.9044.0 

	TITLE	Source/restrict.cpp
	.386P
include listing.inc
if @Version gt 510
.model FLAT
else
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
CONST	SEGMENT DWORD USE32 PUBLIC 'CONST'
CONST	ENDS
_BSS	SEGMENT DWORD USE32 PUBLIC 'BSS'
_BSS	ENDS
$$SYMBOLS	SEGMENT BYTE USE32 'DEBSYM'
$$SYMBOLS	ENDS
$$TYPES	SEGMENT BYTE USE32 'DEBTYP'
$$TYPES	ENDS
_TLS	SEGMENT DWORD USE32 PUBLIC 'TLS'
_TLS	ENDS
;	COMDAT ??_C@_0BL@FOIA@?2Diablo1RestrictedTest?4foo?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
;	COMDAT ??_C@_02IAAH@wt?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
;	COMDAT ??_C@_0BI@JPPI@Diablo1ReadOnlyTest?4foo?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
CRT$XCU	SEGMENT DWORD USE32 PUBLIC ''
CRT$XCU	ENDS
;	COMDAT _SystemSupported
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _RestrictedTest
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _ReadOnlyTest
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
FLAT	GROUP _DATA, CONST, _BSS, CRT$XCU
	ASSUME	CS: FLAT, DS: FLAT, SS: FLAT
endif

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	_SystemSupported
EXTRN	_memset:NEAR
EXTRN	__imp__GetVersionExA@4:NEAR
; Function compile flags: /Ogsy
;	COMDAT _SystemSupported
_TEXT	SEGMENT
_VersionInformation$ = -148
_SystemSupported PROC NEAR				; COMDAT
; File Source/restrict.cpp
; Line 6
	push	ebp
	mov	ebp, esp
	sub	esp, 148				; 00000094H
	push	edi
; Line 8
	xor	edi, edi
; Line 10
	push	148					; 00000094H
	lea	eax, DWORD PTR _VersionInformation$[ebp]
	push	edi
	push	eax
	call	_memset
	add	esp, 12					; 0000000cH
; Line 14
	lea	eax, DWORD PTR _VersionInformation$[ebp]
	mov	DWORD PTR _VersionInformation$[ebp], 148 ; 00000094H
	push	eax
	call	DWORD PTR __imp__GetVersionExA@4
	test	eax, eax
	je	SHORT $L84985
	cmp	DWORD PTR _VersionInformation$[ebp+16], 2
	jne	SHORT $L84985
	cmp	DWORD PTR _VersionInformation$[ebp+4], 5
	jb	SHORT $L84985
; Line 15
	inc	edi
$L84985:
; Line 17
	mov	eax, edi
	pop	edi
; Line 18
	leave
	ret	0
_SystemSupported ENDP
_TEXT	ENDS
PUBLIC	_RestrictedTest
PUBLIC	??_C@_0BL@FOIA@?2Diablo1RestrictedTest?4foo?$AA@ ; `string'
PUBLIC	??_C@_02IAAH@wt?$AA@				; `string'
EXTRN	_fclose:NEAR
EXTRN	_fopen:NEAR
EXTRN	_remove:NEAR
EXTRN	__imp__GetWindowsDirectoryA@8:NEAR
EXTRN	_strcat:NEAR
;	COMDAT ??_C@_0BL@FOIA@?2Diablo1RestrictedTest?4foo?$AA@
_DATA	SEGMENT
??_C@_0BL@FOIA@?2Diablo1RestrictedTest?4foo?$AA@ DB '\Diablo1RestrictedTe'
	DB	'st.foo', 00H				; `string'
_DATA	ENDS
;	COMDAT ??_C@_02IAAH@wt?$AA@
_DATA	SEGMENT
??_C@_02IAAH@wt?$AA@ DB 'wt', 00H			; `string'
; Function compile flags: /Ogsy
_DATA	ENDS
;	COMDAT _RestrictedTest
_TEXT	SEGMENT
_Buffer$ = -260
_RestrictedTest PROC NEAR				; COMDAT
; Line 21
	push	ebp
	mov	ebp, esp
	sub	esp, 260				; 00000104H
	push	esi
; Line 24
	xor	esi, esi
; Line 26
	call	_SystemSupported
	test	eax, eax
	je	SHORT $L84994
	lea	eax, DWORD PTR _Buffer$[ebp]
	push	260					; 00000104H
	push	eax
	call	DWORD PTR __imp__GetWindowsDirectoryA@8
	test	eax, eax
	je	SHORT $L84994
; Line 27
	lea	eax, DWORD PTR _Buffer$[ebp]
	push	OFFSET FLAT:??_C@_0BL@FOIA@?2Diablo1RestrictedTest?4foo?$AA@ ; `string'
	push	eax
	call	_strcat
; Line 28
	lea	eax, DWORD PTR _Buffer$[ebp]
	push	OFFSET FLAT:??_C@_02IAAH@wt?$AA@	; `string'
	push	eax
	call	_fopen
	add	esp, 16					; 00000010H
; Line 29
	test	eax, eax
	je	SHORT $L84993
; Line 30
	push	eax
	call	_fclose
; Line 31
	lea	eax, DWORD PTR _Buffer$[ebp]
	push	eax
	call	_remove
	pop	ecx
	pop	ecx
; Line 32
	jmp	SHORT $L84994
$L84993:
; Line 33
	xor	esi, esi
	inc	esi
$L84994:
; Line 36
	mov	eax, esi
	pop	esi
; Line 37
	leave
	ret	0
_RestrictedTest ENDP
_TEXT	ENDS
PUBLIC	_ReadOnlyTest
PUBLIC	??_C@_0BI@JPPI@Diablo1ReadOnlyTest?4foo?$AA@	; `string'
EXTRN	_strrchr:NEAR
EXTRN	_ghInst:DWORD
EXTRN	__imp__GetModuleFileNameA@12:NEAR
EXTRN	_strcpy:NEAR
;	COMDAT ??_C@_0BI@JPPI@Diablo1ReadOnlyTest?4foo?$AA@
_DATA	SEGMENT
??_C@_0BI@JPPI@Diablo1ReadOnlyTest?4foo?$AA@ DB 'Diablo1ReadOnlyTest.foo', 00H ; `string'
; Function compile flags: /Ogsy
_DATA	ENDS
;	COMDAT _ReadOnlyTest
_TEXT	SEGMENT
_Filename$ = -260
_ReadOnlyTest PROC NEAR					; COMDAT
; Line 40
	push	ebp
	mov	ebp, esp
	sub	esp, 260				; 00000104H
	push	esi
; Line 46
	lea	eax, DWORD PTR _Filename$[ebp]
	push	260					; 00000104H
	push	eax
	push	DWORD PTR _ghInst
	xor	esi, esi
	call	DWORD PTR __imp__GetModuleFileNameA@12
	test	eax, eax
	je	SHORT $L85004
; Line 47
	lea	eax, DWORD PTR _Filename$[ebp]
	push	92					; 0000005cH
	push	eax
	call	_strrchr
	pop	ecx
; Line 48
	test	eax, eax
	pop	ecx
	je	SHORT $L85004
; Line 49
	inc	eax
	push	OFFSET FLAT:??_C@_0BI@JPPI@Diablo1ReadOnlyTest?4foo?$AA@ ; `string'
	push	eax
	call	_strcpy
; Line 50
	lea	eax, DWORD PTR _Filename$[ebp]
	push	OFFSET FLAT:??_C@_02IAAH@wt?$AA@	; `string'
	push	eax
	call	_fopen
	add	esp, 16					; 00000010H
; Line 51
	test	eax, eax
	je	SHORT $L85003
; Line 52
	push	eax
	call	_fclose
; Line 53
	lea	eax, DWORD PTR _Filename$[ebp]
	push	eax
	call	_remove
	pop	ecx
	pop	ecx
; Line 54
	jmp	SHORT $L85004
$L85003:
; Line 55
	xor	esi, esi
	inc	esi
$L85004:
; Line 59
	mov	eax, esi
	pop	esi
; Line 60
	leave
	ret	0
_ReadOnlyTest ENDP
_TEXT	ENDS
END
