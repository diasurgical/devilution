; Listing generated by Microsoft (R) Optimizing Compiler Version 12.00.9044.0 

	TITLE	Source/mainmenu.cpp
	.386P
include listing.inc
if @Version gt 510
.model FLAT
else
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
CONST	SEGMENT DWORD USE32 PUBLIC 'CONST'
CONST	ENDS
_BSS	SEGMENT DWORD USE32 PUBLIC 'BSS'
_BSS	ENDS
$$SYMBOLS	SEGMENT BYTE USE32 'DEBSYM'
$$SYMBOLS	ENDS
$$TYPES	SEGMENT BYTE USE32 'DEBTYP'
$$TYPES	ENDS
_TLS	SEGMENT DWORD USE32 PUBLIC 'TLS'
_TLS	ENDS
;	COMDAT ??_C@_0BO@BLEK@Unable?5to?5display?5SelHeroSing?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
;	COMDAT ??_C@_0BO@JPOH@Can?8t?5load?5multiplayer?5dialog?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
;	COMDAT ??_C@_0N@NJEF@Diablo?5v1?409?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
;	COMDAT ??_C@_0BL@KKDP@Unable?5to?5display?5mainmenu?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
;	COMDAT ??_C@_0BE@CMOB@gendata?2diablo1?4smk?$AA@
_DATA	SEGMENT DWORD USE32 PUBLIC 'DATA'
_DATA	ENDS
CRT$XCU	SEGMENT DWORD USE32 PUBLIC ''
CRT$XCU	ENDS
;	COMDAT _mainmenu_refresh_music
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _mainmenu_create_hero@8
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _mainmenu_select_hero_dialog@40
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _mainmenu_loop
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _mainmenu_single_player
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT @mainmenu_init_menu@4
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _mainmenu_multi_player
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
;	COMDAT _mainmenu_play_intro
_TEXT	SEGMENT PARA USE32 PUBLIC 'CODE'
_TEXT	ENDS
FLAT	GROUP _DATA, CONST, _BSS, CRT$XCU
	ASSUME	CS: FLAT, DS: FLAT, SS: FLAT
endif

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	_menu_music_track_id
_DATA	SEGMENT
COMM	_gszHero:BYTE:010H
_menu_music_track_id DD 05H
_DATA	ENDS
PUBLIC	_mainmenu_refresh_music
EXTRN	@music_start@4:NEAR
; Function compile flags: /Ogsy
;	COMDAT _mainmenu_refresh_music
_TEXT	SEGMENT
_mainmenu_refresh_music PROC NEAR			; COMDAT
; File Source/mainmenu.cpp
; Line 13
	mov	ecx, DWORD PTR _menu_music_track_id
	call	@music_start@4
	mov	eax, DWORD PTR _menu_music_track_id
$L84983:
; Line 15
	inc	eax
; Line 16
	cmp	eax, 6
	jne	SHORT $L84984
; Line 17
	xor	eax, eax
$L84984:
; Line 18
	test	eax, eax
	je	SHORT $L84983
	cmp	eax, 1
	je	SHORT $L84983
; Line 15
	mov	DWORD PTR _menu_music_track_id, eax
; Line 19
	ret	0
_mainmenu_refresh_music ENDP
_TEXT	ENDS
PUBLIC	_mainmenu_create_hero@8
EXTRN	@UiValidPlayerName@4:NEAR
EXTRN	@pfile_create_save_file@8:NEAR
; Function compile flags: /Ogsy
;	COMDAT _mainmenu_create_hero@8
_TEXT	SEGMENT
_name_1$ = 8
_name_2$ = 12
_mainmenu_create_hero@8 PROC NEAR			; COMDAT
; Line 23
	mov	ecx, DWORD PTR _name_1$[esp-4]
	call	@UiValidPlayerName@4
	test	eax, eax
	je	SHORT $L84992
; Line 24
	mov	edx, DWORD PTR _name_2$[esp-4]
	mov	ecx, DWORD PTR _name_1$[esp-4]
	call	@pfile_create_save_file@8
$L84992:
; Line 25
	ret	8
_mainmenu_create_hero@8 ENDP
_TEXT	ENDS
PUBLIC	_mainmenu_select_hero_dialog@40
PUBLIC	??_C@_0BO@BLEK@Unable?5to?5display?5SelHeroSing?$AA@ ; `string'
PUBLIC	??_C@_0BO@JPOH@Can?8t?5load?5multiplayer?5dialog?$AA@ ; `string'
EXTRN	_gbLoadGame:DWORD
EXTRN	_SErrSetLastError@4:NEAR
EXTRN	_SStrCopy@12:NEAR
EXTRN	_UiSelHeroMultDialog@28:NEAR
EXTRN	_UiSelHeroSingDialog@28:NEAR
EXTRN	_gbMaxPlayers:BYTE
EXTRN	@pfile_create_player_description@8:NEAR
EXTRN	_pfile_ui_set_hero_infos@4:NEAR
EXTRN	_pfile_ui_set_class_stats@8:NEAR
EXTRN	_pfile_ui_save_create@4:NEAR
EXTRN	_pfile_delete_save@4:NEAR
EXTRN	_myplr:DWORD
EXTRN	_plr:BYTE
EXTRN	_TermMsg:NEAR
EXTRN	_gnDifficulty:DWORD
;	COMDAT ??_C@_0BO@BLEK@Unable?5to?5display?5SelHeroSing?$AA@
_DATA	SEGMENT
??_C@_0BO@BLEK@Unable?5to?5display?5SelHeroSing?$AA@ DB 'Unable to displa'
	DB	'y SelHeroSing', 00H				; `string'
_DATA	ENDS
;	COMDAT ??_C@_0BO@JPOH@Can?8t?5load?5multiplayer?5dialog?$AA@
_DATA	SEGMENT
??_C@_0BO@JPOH@Can?8t?5load?5multiplayer?5dialog?$AA@ DB 'Can''t load mul'
	DB	'tiplayer dialog', 00H			; `string'
; Function compile flags: /Ogsy
_DATA	ENDS
;	COMDAT _mainmenu_select_hero_dialog@40
_TEXT	SEGMENT
_mode$ = 24
_cname$ = 28
_clen$ = 32
_cdesc$ = 36
_cdlen$ = 40
_multi$ = 44
_hero_is_created$ = -8
_dlgresult$ = -4
_mainmenu_select_hero_dialog@40 PROC NEAR		; COMDAT
; Line 36
	push	ebp
	mov	ebp, esp
	push	ecx
	push	ecx
	push	ebx
	push	edi
; Line 37
	xor	edi, edi
; Line 38
	xor	ebx, ebx
	inc	edi
; Line 39
	cmp	BYTE PTR _gbMaxPlayers, 1
	mov	DWORD PTR _hero_is_created$[ebp], edi
	mov	DWORD PTR _dlgresult$[ebp], ebx
	jne	$L85016
; Line 47
	push	OFFSET FLAT:_gnDifficulty
	lea	eax, DWORD PTR _dlgresult$[ebp]
	push	OFFSET FLAT:_gszHero
	push	eax
	push	OFFSET FLAT:_pfile_ui_set_class_stats@8
	push	OFFSET FLAT:_pfile_delete_save@4
	push	OFFSET FLAT:_pfile_ui_save_create@4
	push	OFFSET FLAT:_pfile_ui_set_hero_infos@4
	call	_UiSelHeroSingDialog@28
	test	eax, eax
	jne	SHORT $L85017
; Line 48
	push	OFFSET FLAT:??_C@_0BO@BLEK@Unable?5to?5display?5SelHeroSing?$AA@ ; `string'
	call	_TermMsg
	pop	ecx
$L85017:
; Line 50
	cmp	DWORD PTR _dlgresult$[ebp], 2
	jne	SHORT $L85019
; Line 51
	mov	DWORD PTR _gbLoadGame, edi
$L85024:
; Line 70
	mov	edx, DWORD PTR _cdlen$[ebp]
	mov	ecx, DWORD PTR _cdesc$[ebp]
	call	@pfile_create_player_description@8
; Line 71
	mov	ecx, DWORD PTR _multi$[ebp]
	cmp	ecx, ebx
	je	SHORT $L85027
; Line 72
	cmp	DWORD PTR _mode$[ebp], 1112425812	; 424e4554H
	jne	SHORT $L85026
; Line 73
	cmp	DWORD PTR _hero_is_created$[ebp], ebx
	jne	SHORT $L85085
	mov	eax, DWORD PTR _myplr
	imul	eax, 21720				; 000054d8H
	cmp	BYTE PTR _plr[eax+21627], bl
	je	SHORT $L85085
	xor	eax, eax
	jmp	SHORT $L85086
$L85019:
; Line 53
	mov	DWORD PTR _gbLoadGame, ebx
; Line 55
	jmp	SHORT $L85022
$L85016:
; Line 62
	lea	eax, DWORD PTR _hero_is_created$[ebp]
	push	OFFSET FLAT:_gszHero
	push	eax
	lea	eax, DWORD PTR _dlgresult$[ebp]
	push	eax
	push	OFFSET FLAT:_pfile_ui_set_class_stats@8
	push	OFFSET FLAT:_pfile_delete_save@4
	push	OFFSET FLAT:_pfile_ui_save_create@4
	push	OFFSET FLAT:_pfile_ui_set_hero_infos@4
	call	_UiSelHeroMultDialog@28
	test	eax, eax
	jne	SHORT $L85022
; Line 63
	push	OFFSET FLAT:??_C@_0BO@JPOH@Can?8t?5load?5multiplayer?5dialog?$AA@ ; `string'
	call	_TermMsg
	pop	ecx
$L85022:
; Line 65
	cmp	DWORD PTR _dlgresult$[ebp], 4
	jne	SHORT $L85024
; Line 66
	push	1223					; 000004c7H
	call	_SErrSetLastError@4
; Line 67
	xor	eax, eax
	jmp	SHORT $L85013
$L85085:
; Line 73
	mov	eax, edi
; Line 74
	jmp	SHORT $L85086
$L85026:
; Line 75
	mov	eax, DWORD PTR _hero_is_created$[ebp]
$L85086:
	mov	DWORD PTR [ecx], eax
$L85027:
; Line 77
	cmp	DWORD PTR _cname$[ebp], ebx
	je	SHORT $L85028
	cmp	DWORD PTR _clen$[ebp], ebx
	je	SHORT $L85028
; Line 78
	push	DWORD PTR _clen$[ebp]
	push	OFFSET FLAT:_gszHero
	push	DWORD PTR _cname$[ebp]
	call	_SStrCopy@12
$L85028:
; Line 80
	mov	eax, edi
$L85013:
	pop	edi
	pop	ebx
; Line 81
	leave
	ret	40					; 00000028H
_mainmenu_select_hero_dialog@40 ENDP
_TEXT	ENDS
PUBLIC	_mainmenu_loop
PUBLIC	_mainmenu_single_player
PUBLIC	_mainmenu_multi_player
PUBLIC	_mainmenu_play_intro
PUBLIC	??_C@_0N@NJEF@Diablo?5v1?409?$AA@		; `string'
PUBLIC	??_C@_0BL@KKDP@Unable?5to?5display?5mainmenu?$AA@ ; `string'
EXTRN	_gbActive:DWORD
EXTRN	_effects_play_sound@4:NEAR
EXTRN	_UiCreditsDialog@4:NEAR
EXTRN	_UiMainMenuDialog@16:NEAR
EXTRN	_music_stop:NEAR
;	COMDAT ??_C@_0N@NJEF@Diablo?5v1?409?$AA@
_DATA	SEGMENT
??_C@_0N@NJEF@Diablo?5v1?409?$AA@ DB 'Diablo v1.09', 00H ; `string'
_DATA	ENDS
;	COMDAT ??_C@_0BL@KKDP@Unable?5to?5display?5mainmenu?$AA@
_DATA	SEGMENT
??_C@_0BL@KKDP@Unable?5to?5display?5mainmenu?$AA@ DB 'Unable to display m'
	DB	'ainmenu', 00H				; `string'
; Function compile flags: /Ogsy
_DATA	ENDS
;	COMDAT _mainmenu_loop
_TEXT	SEGMENT
_menu$ = -4
_mainmenu_loop PROC NEAR				; COMDAT
; Line 84
	push	ebp
	mov	ebp, esp
	push	ecx
; Line 89
	call	_mainmenu_refresh_music
$L85032:
; Line 92
	and	DWORD PTR _menu$[ebp], 0
; Line 93
	push	30					; 0000001eH
	lea	eax, DWORD PTR _menu$[ebp]
	push	OFFSET FLAT:_effects_play_sound@4
	push	eax
	push	OFFSET FLAT:??_C@_0N@NJEF@Diablo?5v1?409?$AA@ ; `string'
	call	_UiMainMenuDialog@16
	test	eax, eax
	jne	SHORT $L85035
; Line 94
	push	OFFSET FLAT:??_C@_0BL@KKDP@Unable?5to?5display?5mainmenu?$AA@ ; `string'
	call	_TermMsg
	pop	ecx
$L85035:
; Line 96
	mov	eax, DWORD PTR _menu$[ebp]
	dec	eax
	je	SHORT $L85042
	dec	eax
	je	SHORT $L85044
	dec	eax
	je	SHORT $L85046
	dec	eax
	je	SHORT $L85048
	dec	eax
	je	SHORT $L85049
	dec	eax
	jne	SHORT $L85032
$L85046:
; Line 107
	cmp	DWORD PTR _gbActive, 0
	je	SHORT $L85032
; Line 108
	call	_mainmenu_play_intro
; Line 109
	jmp	SHORT $L85032
$L85048:
; Line 111
	push	16					; 00000010H
	call	_UiCreditsDialog@4
; Line 112
	jmp	SHORT $L85032
$L85044:
; Line 102
	call	_mainmenu_multi_player
	jmp	SHORT $L85095
$L85042:
; Line 98
	call	_mainmenu_single_player
$L85095:
	test	eax, eax
; Line 117
	jne	SHORT $L85032
$L85049:
; Line 119
	call	_music_stop
; Line 120
	leave
	ret	0
_mainmenu_loop ENDP
_TEXT	ENDS
PUBLIC	@mainmenu_init_menu@4
; Function compile flags: /Ogsy
;	COMDAT _mainmenu_single_player
_TEXT	SEGMENT
_mainmenu_single_player PROC NEAR			; COMDAT
; Line 125
	xor	ecx, ecx
	inc	ecx
	mov	BYTE PTR _gbMaxPlayers, cl
; Line 126
	jmp	@mainmenu_init_menu@4
_mainmenu_single_player ENDP
_TEXT	ENDS
EXTRN	@StartGame@8:NEAR
; Function compile flags: /Ogsy
;	COMDAT @mainmenu_init_menu@4
_TEXT	SEGMENT
@mainmenu_init_menu@4 PROC NEAR				; COMDAT
; _type$ = ecx
; Line 131
	push	esi
	mov	esi, ecx
; Line 134
	cmp	esi, 4
	jne	SHORT $L85055
; Line 135
	xor	eax, eax
	pop	esi
	inc	eax
; Line 144
	ret	0
$L85055:
; Line 137
	call	_music_stop
; Line 139
	xor	edx, edx
	cmp	esi, 3
	setne	dl
	xor	ecx, ecx
	cmp	esi, 2
	setne	cl
	call	@StartGame@8
	mov	esi, eax
; Line 140
	test	esi, esi
	je	SHORT $L85056
; Line 141
	call	_mainmenu_refresh_music
$L85056:
; Line 143
	mov	eax, esi
	pop	esi
; Line 144
	ret	0
@mainmenu_init_menu@4 ENDP
; Function compile flags: /Ogsy
_TEXT	ENDS
;	COMDAT _mainmenu_multi_player
_TEXT	SEGMENT
_mainmenu_multi_player PROC NEAR			; COMDAT
; Line 149
	push	3
	mov	BYTE PTR _gbMaxPlayers, 4
	pop	ecx
	jmp	@mainmenu_init_menu@4
_mainmenu_multi_player ENDP
_TEXT	ENDS
PUBLIC	??_C@_0BE@CMOB@gendata?2diablo1?4smk?$AA@	; `string'
EXTRN	@play_movie@8:NEAR
;	COMDAT ??_C@_0BE@CMOB@gendata?2diablo1?4smk?$AA@
_DATA	SEGMENT
??_C@_0BE@CMOB@gendata?2diablo1?4smk?$AA@ DB 'gendata\diablo1.smk', 00H ; `string'
; Function compile flags: /Ogsy
_DATA	ENDS
;	COMDAT _mainmenu_play_intro
_TEXT	SEGMENT
_mainmenu_play_intro PROC NEAR				; COMDAT
; Line 154
	call	_music_stop
; Line 155
	xor	edx, edx
	mov	ecx, OFFSET FLAT:??_C@_0BE@CMOB@gendata?2diablo1?4smk?$AA@ ; `string'
	inc	edx
	call	@play_movie@8
; Line 156
	jmp	_mainmenu_refresh_music
_mainmenu_play_intro ENDP
_TEXT	ENDS
END
